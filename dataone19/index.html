<!DOCTYPE html>
<html>
  <head>
    <title>rOpenSci Data Packages</title>
    <meta charset="utf-8">
    <meta name="author" content="Scott Chamberlain" />
    <link href="index_files/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="index_files/font-awesome-5.3.1/css/fontawesome-all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="scott-theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# rOpenSci Data Packages
### Scott Chamberlain

---


## .large[Why Data Packages?]

&lt;ul&gt;
  &lt;li style="font-size:40px";&gt;Reduce duplicated effort by each researcher&lt;/li&gt;
  &lt;li style="font-size:40px";&gt;One best way to get data XYZ&lt;/li&gt;
  &lt;li style="font-size:40px";&gt;Reduced user error&lt;/li&gt;
  &lt;li style="font-size:40px";&gt;Allow researchers to focus on the science&lt;/li&gt;
&lt;/ul&gt;

---

## .large[Data Packages: Caveats]

&lt;ul&gt;
  &lt;li style="font-size:40px";&gt;User base (# of people) for data pkgs small relative to utilities&lt;/li&gt;
  &lt;ul&gt;
    &lt;li style="font-size:40px";&gt;... attracts fewer contributors&lt;/li&gt;
    &lt;li style="font-size:40px";&gt;... &amp;amp; all the carry on effects of above&lt;/li&gt;
  &lt;/ul&gt;
  &lt;li style="font-size:40px";&gt;Pkg can get out of sync with data source's API&lt;/li&gt;
  &lt;li style="font-size:40px";&gt;Risk leaving out metadata/context&lt;/li&gt;
&lt;/ul&gt;

---

## .large[rOpenSci Data Packages]

&lt;ul&gt;
  &lt;li style="font-size:40px";&gt;Biological occurrences&lt;/li&gt;
  &lt;li style="font-size:40px";&gt;Taxonomy&lt;/li&gt;
  &lt;li style="font-size:40px";&gt;Data utilities&lt;/li&gt;
&lt;/ul&gt;

&lt;br&gt;

&lt;h2 style="color:grey"&gt;find more: &lt;a href="https://ropensci.org/packages/"&gt;ropensci.org/packages&lt;/a&gt;&lt;/h2&gt;

---

## .large[Occurrence Data Packages]

&lt;ul&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/spocc"&gt;spocc&lt;/a&gt; - Biodiversity data toolbelt&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/rgbif"&gt;rgbif&lt;/a&gt; - GBIF data&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/ecoengine"&gt;ecoengine&lt;/a&gt; - Berekeley Ecoengine client&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/rinat"&gt;rinat&lt;/a&gt; - iNaturalist client&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/rbison"&gt;rbison&lt;/a&gt; - USGS BISON client&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/rebird"&gt;rebird&lt;/a&gt; - eBird data via their API&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/CornellLabofOrnithology/auk"&gt;auk&lt;/a&gt; - eBird bulk data&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/rvertnet"&gt;rvertnet&lt;/a&gt; - VertNet data&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/rfishbae"&gt;rfishbase&lt;/a&gt; - Fishbase.org data&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/finch"&gt;finch&lt;/a&gt; - Handle Darwin Core&lt;/li&gt;
&lt;/ul&gt;

---

## .large[Data package patterns]

&lt;h3&gt;Or at least patterns we strive towards ...&lt;/h3&gt;

&lt;ul&gt;
  &lt;li style="font-size:30px";&gt;HTTP requests&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;Cache downloaded data for FTP/similar files&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;Return data.frame's: facilitates downstream processing&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;Make it easy to cite data providers&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;Incorporate metadata&lt;/li&gt;
&lt;/ul&gt;

---

## .large[rgbif usage]

[Bemmels, et al. (2018) -- Filter-dispersal assembly of lowland Neotropical rainforests across the Andes](https://doi.org/10.1111/ecog.03473)

&lt;img src="img/bemmelsetal.png" width="250"&gt;

&gt; _... records were obtained for each species ... using ... `rgbif` ... Quality controls were applied to ensure that occurrence records were correctly taxonomically identified and accurately georeferenced. In particular, records with the following issues were excluded ... invalid coordinates or geodetic datum; failed or suspicious coordinate reprojection; ... species name with no match ..._

~70 more e.g.'s at &lt;https://github.com/ropensci/roapi/blob/master/data/citations.csv&gt;

---

## .large[rgbif usage: Checklist recipe]

[TrIAS Project](https://github.com/trias-project) - [standardizing species checklist data to Darwin Core using R](https://ropensci.org/blog/2018/11/20/checklist-recipe/)

```
├── README.md              : Description of this repository
├── LICENSE                : Repository license
├── checklist-recipe.Rproj : RStudio project file
├── .gitignore             : Files and directories to be ignored by git
│
├── data
│   ├── raw                : Source data, input for mapping script
│   └── processed          : Darwin Core output of mapping script GENERATED
│
├── docs                   : Repository website GENERATED
└── src
    ├── dwc_mapping.Rmd    : Darwin Core mapping script, core functionality
    ├── _site.yml          : Settings to build website in /docs
    └── index.Rmd          : Template for website homepage
```

&lt;img src="img/rgbif_logo.png" width="80" style="float:right"&gt;

<i class="fab  fa-github "></i> &lt;a href="https://github.com/ropensci/rgbif"&gt;rgbif&lt;/a&gt;

---

## .large[Taxonomy Packages]

&lt;ul&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/taxa"&gt;taxa&lt;/a&gt; - Taxonomic R classes&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/taxize"&gt;taxize&lt;/a&gt; - Taxonomic toolbelt (remote data)&lt;/li&gt;
  &lt;ul&gt;
    &lt;li style="font-size:30px";&gt;&lt;a href="https://ropensci.github.io/taxize-book/"&gt;taxize book&lt;/a&gt;&lt;/li&gt;
  &lt;/ul&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/taxizedb"&gt;taxizedb&lt;/a&gt; - Leverage dumps of taxonomic database locally&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/ritis"&gt;ritis&lt;/a&gt; - USGS's ITIS&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/rotl"&gt;rotl&lt;/a&gt; - Open Tree of Life&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/rentrez"&gt;rentrez&lt;/a&gt; - NCBI ENTREZ taxonomy database&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/worrms"&gt;worrms&lt;/a&gt; - WORMS marine taxonomy&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/wikitaxa"&gt;wikitaxa&lt;/a&gt; - Taxonomy data on Wikipedia&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropenscilabs/zbank"&gt;zbank&lt;/a&gt; - ZooBank&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/rgbif"&gt;rgbif&lt;/a&gt; - GBIF taxonomy data&lt;/li&gt;
&lt;/ul&gt;

---

## .large[taxize usage]

[Liang, J., et al. (2016) -- Positive biodiversity-productivity relationship predominant in global forests](https://doi.org/10.1126/science.aaf8957)

![liang_etal](img/liang_etal.png)

&gt; _there were ... 8,737 species ... We verified all ... names against 60 taxonomic data-bases, including NCBI, GRIN Taxonomy for Plants, Tropicos–Missouri Botanical Garden, and the International Plant Names Index, using the ‘taxize’ package in R_

~90 more e.g.'s at &lt;https://github.com/ropensci/roapi/blob/master/data/citations.csv&gt;

---

## .large[taxize project]

&lt;h3&gt;highlight a project that uses taxize ...&lt;/h3&gt;


---

## .large[Utility Packages]

&lt;ul&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/jqr"&gt;jqr&lt;/a&gt; - R client for &lt;a href="https://github.com/stedolan/jq/"&gt;jq&lt;/a&gt;, the JSON processor&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/jsonld"&gt;jsonld&lt;/a&gt; - JSON linked data&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/rerddap"&gt;rerddap&lt;/a&gt; - ERDDAP server client&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/rdflib"&gt;rdflib&lt;/a&gt; - RDF pkg, wrapped around Redland&lt;/li&gt;
  &lt;li style="font-size:30px";&gt;&lt;a href="https://github.com/ropensci/assertr"&gt;assertr&lt;/a&gt; - Assertions for analysis pipelines&lt;/li&gt;
&lt;/ul&gt;

---

## .large[assertr usage: eg]

[Brain Somatic Mosaicism Network](https://github.com/bsmn) - [Validate BSMN Grant Data ](https://github.com/bsmn/grantdatavalidator)

![gsmn_repo](img/bsmn_repo.png)

```r
 data %&gt;%
    assertr::chain_start() %&gt;%
    assertr::verify(nrow(data) == 3) %&gt;%
    assertr::verify(assertr::is_uniq(nda_short_name)) %&gt;%
    assertr::verify(assertr::not_na(grant)) %&gt;%
    assertr::verify(dplyr::n_distinct(grant) == 1) %&gt;%
    assertr::verify(nda_short_name %in% expected_nda_short_names) %&gt;%
    assertr::chain_end() %&gt;%
    tibble::as_tibble()
```

<i class="fab  fa-github "></i> &lt;a href="https://github.com/ropensci/assertr"&gt;assertr&lt;/a&gt;

---

## .large[rerddap usage: eg]

[Abolaffio, J., et al. (2018) -- Olfactory-cued navigation in shearwaters: linking movement patterns to mechanisms](https://doi.org/10.1038/s41598-018-29919-0)

&lt;img src="img/abolaffio_etal.png" width="350px"&gt;

&lt;!-- ![abolaffio_etal](img/abolaffio_etal.png) --&gt;

&gt; _wind data were downloaded from the NOAA web site from the `rerdapp` package for R_

<i class="fab  fa-github "></i> &lt;a href="https://github.com/ropensci/rerddap"&gt;rerddap&lt;/a&gt;

---

## .large[Data integration: Steps]

&lt;ul&gt;
  &lt;li style="font-size:40px";&gt;Start with a species list&lt;/li&gt;
  &lt;li style="font-size:40px";&gt;Clean names with &lt;a href="https://github.com/ropensci/taxize"&gt;taxize&lt;/a&gt;&lt;/li&gt;
  &lt;li style="font-size:40px";&gt;Get occurrence data with &lt;a href="https://github.com/ropensci/rgbif"&gt;rgbif&lt;/a&gt;&lt;/li&gt;
  &lt;li style="font-size:40px";&gt;Clean occurrence data w/ &lt;a href="https://github.com/ropensci/rgbif"&gt;rgbif&lt;/a&gt;, &lt;a href="https://github.com/ropensci/scrubr"&gt;scrubr&lt;/a&gt; or &lt;a href="https://github.com/ropensci/CoordinateCleaner"&gt;CoordinateCleaner&lt;/a&gt;&lt;/li&gt;
  &lt;li style="font-size:40px";&gt;&lt;a href="https://github.com/ropensci/assertr"&gt;assertr&lt;/a&gt; to check data&lt;/li&gt;
  &lt;li style="font-size:40px";&gt;Map with &lt;a href="https://github.com/ropensci/mapr"&gt;mapr&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

---

## .large[Data integration: code]


```r
#spp &lt;- names_list("species")
spp &lt;- read.csv("spp_list.txt", header = TRUE, stringsAsFactors = FALSE)$bad
spp2 &lt;- taxize::gnr_resolve(spp, data_source_ids=11, canonical=TRUE)$matched_name2
dat &lt;- rgbif::occ_data(scientificName = spp2, limit = 100)
# remove occurrences with COUNTRY_MISMATCH issues
# lapply(dat, function(w) rgbif::occ_issues(dat, -cum))
# FIXME: put back in place once rgbif thing fixed
# dat &lt;- rgbif::occ_issues(dat, -cum)
# dat &lt;- scrubr::coord_impossible(dat)
```

---

## .large[Data integration: code]

```r
 data %&gt;%
    assertr::chain_start() %&gt;%
    assertr::verify(nrow(data) == 3) %&gt;%
    assertr::verify(assertr::is_uniq(nda_short_name)) %&gt;%
    assertr::verify(assertr::not_na(grant)) %&gt;%
    assertr::verify(dplyr::n_distinct(grant) == 1) %&gt;%
    assertr::verify(nda_short_name %in% expected_nda_short_names) %&gt;%
    assertr::chain_end() %&gt;%
    tibble::as_tibble()
```

```r
mapr::map_leaflet(dat)
```

![leaflet_map](img/leaflet_map.png)
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create();
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
